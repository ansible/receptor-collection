- name: Sure that receptor folder is empty
  ansible.builtin.file:
    state: absent
    path: "{{ receptor_git_path }}"

- name: Clone ansible-receptor repository
  ansible.builtin.git:
    repo: "{{ receptor_github_url }}"
    dest: "{{ receptor_git_path }}"
    version: "{{ receptor_version }}"
    force: true

- name: Build ansible-receptor
  community.general.make:
    chdir: "{{ receptor_git_path }}"

- name: Copy receptor's build to "{{ receptor_install_dir }}"
  ansible.builtin.copy:
    src: "{{ receptor_make_path }}"
    dest: "{{ receptor_install_dir }}"
    remote_src: true

- name: Add receptor's path to profile
  ansible.builtin.copy:
    dest: /etc/profile.d/receptor.sh
    content: "PATH=$PATH:{{ receptor_install_dir }}" 

- name: Create receptor's systemd service
  ansible.builtin.template:
    src: templates/receptor.service.j2
    dest: /lib/systemd/system/receptor.service
    mode: '0644'
    owner: root
    group: root
